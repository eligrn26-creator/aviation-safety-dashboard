---
title: "SMS-Relevant Accident Trends"
author: "Eli Green"
date: "2025-10-02"
output: html_document
---

### 1. **R Code Chunk (setup)**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(tidyr)
library(lubridate)
library(stringr)
```
## Overview

This report analyzes aviation accident data to identify events relevant to Safety Management System (SMS) domains. It flags accidents based on keyword matching and visualizes trends across domains, regions, and operator types.

```{r mock-data}
all_accidents <- tibble::tibble(
  event_date = as.Date(c("2020-01-01", "2021-06-15", "2022-03-10")),
  probable_cause_clean = c(
    "Pilot fatigue and checklist omission",
    "Engine failure due to hydraulic leak",
    "Weather conditions caused loss of visibility"
  ),
  region = c("Eastern", "Western", "Southern"),
  operator_type = c("Commercial", "Private", "Cargo")
)
```

```{r sms-flagging}
# Define SMS keyword domains
sms_keywords <- list(
  human = c("fatigue", "training", "judgment", "distraction"),
  mechanical = c("engine", "gear", "hydraulic", "failure"),
  environmental = c("weather", "visibility", "wind", "icing"),
  operational = c("procedure", "checklist", "briefing", "coordination"),
  procedural = c("policy", "compliance", "manual", "regulation")
)

# Flagging function
flag_sms <- function(text, keyword_list) {
  sapply(keyword_list, function(keywords) {
    str_detect(text, str_c(keywords, collapse = "|"))
  }) %>% as_tibble() %>% setNames(names(keyword_list))
}

# Apply flags
sms_flags <- flag_sms(all_accidents$probable_cause_clean, sms_keywords)

# Bind flags and enrich dataset
all_accidents <- all_accidents %>%
  mutate(
    human = sms_flags$human,
    mechanical = sms_flags$mechanical,
    environmental = sms_flags$environmental,
    operational = sms_flags$operational,
    procedural = sms_flags$procedural,
    sms_flag = human | mechanical | environmental | operational | procedural,
    event_year = year(event_date)
  )
```
```{r sms-trends}
sms_long <- all_accidents %>%
  select(event_year, region, operator_type,
         human, mechanical, environmental, operational, procedural) %>%
  pivot_longer(cols = human:procedural, names_to = "domain", values_to = "flag") %>%
  filter(flag == TRUE)

ggplot(sms_long, aes(x = event_year, fill = operator_type)) +
  geom_bar(position = "stack") +
  facet_wrap(~ domain, scales = "free_y") +
  labs(
    title = "SMS-Relevant Accidents by Domain and Operator Type",
    x = "Year",
    y = "Number of Accidents",
    fill = "Operator Type",
    caption = "Source: NTSB accident data"
  ) +
  theme_minimal()
```
## Observations

- **Human factors** dominate early years, suggesting training and judgment issues.
- **Mechanical failures** show spikes in certain yearsâ€”potential maintenance trends.
- **Environmental triggers** correlate with seasonal patterns.
- **Operator type** breakdown reveals differing domain exposures.

## Next Steps

- Add interactivity with Shiny or Plotly
- Export visuals for dashboard integration
- Bundle with other portfolio pieces (e.g., injury severity analysis, regional risk maps)

```{r sms-summary}
sms_summary <- all_accidents %>%
  summarise(
    Human = sum(human),
    Mechanical = sum(mechanical),
    Environmental = sum(environmental),
    Operational = sum(operational),
    Procedural = sum(procedural),
    Total_SMS_Flagged = sum(sms_flag)
  )
knitr::kable(sms_summary, caption = "Summary of SMS-Relevant Accidents by Domain")#### ðŸ§© Shiny Dashboard Scaffold (for later)
```

#### ðŸ§© Shiny Dashboard Scaffold (for later)

```{r, eval=FALSE}
# shinyApp(
#   ui = fluidPage(
#     selectInput("domain", "Choose SMS Domain", choices = names(sms_keywords)),
#     plotOutput("trendPlot")
#   ),
#   server = function(input, output) {
#     output$trendPlot <- renderPlot({
#       filtered <- sms_long %>% filter(domain == input$domain)
#       ggplot(filtered, aes(x = event_year, fill = operator_type)) +
#         geom_bar() + theme_minimal()
#     })
#   }
# )
```


